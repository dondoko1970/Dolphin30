# (作成途中)Dolphin30　ビルドガイド
## 同梱品
- PCB基板

<img src="images/pcb.jpg" width="80%" />

- スイッチプレート

<img src="images/switchpl.jpg" width="80%" />

- ボトムプレート

<img src="images/bottompl.jpg" width="80%" />

- RP2040-Core-A(以下マイコンと呼称)

<img src="images/corea.jpg" width="80%" />

- USB Type-Cコネクタ DIP化基板(以下USB基板と呼称)

<img src="images/usb1.jpg" width="80%" />

- ピンヘッダ 1セット(写真のほかに、USB基板付属の4ピンのもの1セット)

<img src="images/pinheader.jpg" width="80%" />

- ゴム足　4個

## 同梱品まとめ
|パーツ名|個数|
|:---|---:|
|PCB基板|1|
|スイッチプレート|1|
|ボトムプレート|1|
|RP2040-Core-A「マイコン」|1|
|USB Type-Cコネクタ DIP化基板「USB基板」|1|
|ピンヘッダ|1セット|
|ゴム足|4|

## その他必要なパーツ

|パーツ名|備考|個数|
|:---|:---|---:|
|MXスイッチ用Kailh PCBソケット||30|
|1N4148 ダイオード(SMDタイプ)||30|
|M2ネジ|3mm|14|
|M2スペーサー|8mm|7|

# 作製手順

<img src="images/20250822_223659.jpg" width="80%" />

完成形(PCB基板裏面。ボトムプレートを外したところ)

## 最初に
以下、PCB基板の「Dolphin30」の表記のある側を「裏面」、反対側を「表面」と呼称します。

## 基板のフチの色塗り

PCB基板、スイッチプレート、ボトムプレートの「ふち」は、切断面が白っぽく、見映えがあまり良くないので黒のマーカーで塗ることをおすすめします。

## マイコンのはんだ付け
PCB基板にマイコンをはんだ付けします。

### 短辺のはんだ付け
マイコンは、ピンヘッダを使ってはんだ付けします。ピンヘッダは6ピンのものを3セット使いますので、長い物は適当にカットして下さい。

![マイコン拡大図](images/dolphin30micom.jpg)

基板の裏面を上にします。

マイコンのBOOTスイッチのある面を上に向けて、短辺(ピン数=7の辺)2辺に、ピン数6のピンヘッダを、ピンの「長い側」から差し込み、マスキングテープなどで基板に仮止めします。

ピンヘッダを差し込むピンは、7番から12番までの6つと、29番からGNDまでの6つです。

基板を裏返し(表面)、全てのピンをはんだ付けします。

はんだ付け前あるいははんだ付け後に、ピンの頭をニッパでカットします。

※ このとき、ニッパがマイコン上の部品に触れて壊すことのないよう、十分気をつけて下さい。BOOTボタンはとくに脆いと思いますので注意して下さい。

次に基板を裏返します(裏面)。ピンに付いている、プラスチックのパーツを、マイコン上の部品に触れないよう気をつけながら引き抜きます(このパーツを取り除かないと、マイコンの高さが高すぎて、組立時にボトムプレートと干渉します)。あるいは、引き抜かなくても、隙間にニッパを入れてピンを切れるようでしたら、先に切ってしまっても差し支えないと思います。くれぐれもマイコン上のパーツを壊さないよう注意して下さい。

ピンをはんだ付けし、余ったピンの頭をカットします(先にカットしてからはんだ付けでも大丈夫です)。

### 長辺のはんだ付け

今度は基板の裏面から、長辺(ピン数=8の辺)のうち、13,14,15,26,27,28のピンに、ピン数6のピンヘッダを差し込み、マスキングテープなどで基板に仮止めします。(0～5番のピンは、はんだ付けは不要です)

基板を表面に返します。

この部分は、完成後にキースイッチを差し込む際に、SW24(基板に表記)とわずかに干渉する恐れがあるので、できるだけはんだの背が低く仕上がるように、はんだ付け前にピンの頭をカットしておくことをおすすめします。

表面から、全てのピンをはんだ付けします。

※ 十分短く切ってしまってもはんだ付けできると思いますが、私は少し心配だったので、わずかに(1mm弱)頭が残るようにカットしました。

あとは短辺のときと同様に、基板の裏面から、ピンヘッダのプラスティックの部品を外し、この面もはんだ付けし、余ったピンの頭をカットします。

## USB基板のはんだ付け
USB基板は、2ピンのピンヘッダ2個を使って、マイコンと同じように、基板にはんだ付けします。ピンヘッダの頭はなるべく低くなるようカットします。(マイコンの長辺の時ほど高さにシビアになる必要はありません)

※ PCB基板上の「V D- D+ G」の表記と、USB基板上の同様の文字の向きが一致するように配置します。USB端子が表側(上側)になります。

## ファームウェアの書き込み
PCと接続して、ファームウェアを書き込みし、動作の確認をします。

[このページ](firmware/readme.md)からファームウェアをダウンロードします(.uf2ファイル)。

マイコン上のBOOTボタンを押しながら、USB-C端子でPCと接続すると、キーボードがドライブとして認識されます。このドライブのルートフォルダに、ダウンロードしたファイルをドラッグ&ドロップすると、書き込みが行われ、自動的にキーボードのマイコンが再起動され、今度はキーボードとして認識されます。

もし、PCに接続しても認識がされない場合、はんだ付けが正しくされていないピンがあるかもしれません。全てのピンがピンヘッダを通じて基板にはんだ付けされていることを確認して下さい。  

この段階ではまだ文字入力は行えません。キーボードが認識され、ファームウェアの書き込みができれば十分です。詳細には、Vialアプリを起動またはVialのウェブサイトを開いて、正しくキーボードが認識されているのを確かめることもできます。

マイコンの挙動が確認できましたので、次のステップに進んで下さい。

## ダイオードとスイッチソケットのはんだ付け
ダイオードとスイッチソケット各30個をはんだ付けします。ダイオードは取付向きがあるので注意して下さい。基板上のフットプリントの「短い線」と、ダイオード部品に書かれた縦線のある側を合わせるようにはんだ付けします。

## 入力動作の確認
キースイッチを取り付ける前に、すべての部品が正しくはんだ付けされているかを確認するために、Vialを起動して、MatrixTesterをクリックし、下部のボタン'unlock'を押します。アンロックするためには、左下の2つのボタンを同時に押す必要があるので、この二つのスイッチだけ基板のソケットに差し込みんで、ロックが解除になるまでボタンを同時押しします。

基板の裏側から各ソケットの2つの端子をピンセットなどで短絡すると、キーを押下したことになります。全てのキーを順番に短絡していって、MatrixTesterの全てのキーを反転させることが出来たら、テストは成功です。

## キースイッチの仮取り付け
四隅のキースイッチをまずは仮組みのために取り付けます。スイッチプレート四隅のスイッチ穴にキースイッチを差し、PCB基板にスイッチを差し込みます。これでスイッチプレートと基板が固定されました。

## プレートの組み立て ～ 最終仕上げまで
ボトムプレートとスイッチプレートには、7箇所のネジ穴があります。

ボトムプレートの裏側(「Dolphin30」と書かれた側)からM2ネジを差し込んで、7個のM2スペーサーを固定します。

ボトムプレートと、先に一体となっているスイッチプレート・PCB基板を重ねて、表側からM2ネジで固定します。

残っているスイッチをスイッチプレート・PCB基板に差し込みます。マイコン近くの2つのスイッチのみ、向きが上下逆になりますので注意して下さい。

ボトムプレートの四隅に、ゴム足を貼り付けます。

これで完成です。作業お疲れ様でした。

キーマップやおすすめの使い方について、[こちらのページ](keymap.md)をぜひご覧下さい。
